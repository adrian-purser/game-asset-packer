GAP File Format
===============


Each line that is not empty or a comment contains a command. The structure of the command can be seen below -

<command>[,<parameter]...

where parameter is a key/value pair -

<key>[=<value>]

e.g.,

loadimage,src="test.png"

Note: The value is optional for certain parameters.

Commands
========

+-----------------+---------------------------------------------------------------------------------------------+
| Command         |  Description                                                                                |
+-----------------+---------------------------------------------------------------------------------------------+
| COLOURMAP       | Load a colourmap or select an existing colourmap                                            |
| EXPORT          | Export the data to a file in a specified format                                             |
| IMAGE           | Add an image to the current image group.                                                    |
| IMAGEARRAY      | Add a series of images from a 2 dimensional array within the source image.                  | 
| IMAGEGROUP      | Set the active image group. Following images will be added to this group.                   |
| LOADIMAGE       | Load a source image. Following image related commands will use this as source.              |
| TILE            | Add a tile to the current tileset                                                           |
| TILEARRAY       | Add a series of tiles from a 2 dimensional array of images from the source image.           |
| TILESET         | Create an empty tileset or select an existing tileset.                                      |
| SOUND           | Create a new sound. Following sound commands will configfure this sound.                    |
| SOUND_MODULE    | Add a module to the current sound.                                                          |
| SOUND_CONNECT   | Connect modules within the current sound.                                                   |
| SOUND_CONTROL   | Select control input for the current sound.                                                 |
| SOUND_OUTPUT    | Select output for the current sound.                                                        |
| SOUND_DATA      | Load data for use by the current sound. Currently there is a maximum of one data object.    |
+-----------------+---------------------------------------------------------------------------------------------+

COLOURMAP
---------

Load a colourmap or select an existing one.

SRC                          The filename/path of the colourmap file that should be loaded.
NAME                         The name of the colourmap. If the SRC is not provided then an existing colourmap 
                             with this name will be selected.

EXPORT
------

Export the data to a file in a specified format.

FILENAME or PATH             The filename of the target file.
NAME                         The name of the package.
TYPE                         The type of file. Currently only type GBIN is supported.
FORMAT                       The format or encoding of the output file. Supported values are BINARY, C_ARRAY, 
                             CPP_VECTOR and CPP_STDARRAY.

FILE
----

Add a file to the package. The file will be loaded as binary and added as uncompressed data.  The files will be added
to the package in a single list. There is no folder structure so all files should be given a unique name.

SRC                          The filename/path of the file on the local filesystem.
NAME                         The name that the file will be given in the package. If not specified then the
                             source filename will be used. There is a limit of 15 characters. A file extension
                             is not required.
TYPE                         The type of the file. This is a 4CC so there is a maximum 4 characters.


IMAGE
-----

Add an image to the current imagegroup. The image is taken as a subimage of the current source image if the subimage 
coordinates are specified, otherwise the whole source image is used.

X                            X coordinate in pixels of the top left of the source region within the parent image
Y                            Y coordinate in pixels of the top left of the source region within the parent image
W or WIDTH                   Width of the image source region in pixels. The output image width may differ if it is rotated or has empty regions removed.
H or HEIGHT                  Height of the image source region in pixels. The output image height may differ if it is rotated or has empty regions removed.
XO or XORIGIN                X Origin of the image in pixels. The image will be rendered with the origin placed at 
                             the specified coordinate. Rotations will use this as the origin of rotation. The final origin coordinate may differ after
                             any rotations have been applied.
YO or YORIGIN                Y Origin of the image in pixels. The image will be rendered with the origin placed at 
                             the specified coordinate. Rotations will use this as the origin of rotation. The final origin coordinate may differ after
                             any rotations have been applied.
ANGLE ot ROTATE              Angle in degrees to rotate the image. The image will be rotated around the origin specified by XO,YO. If COUNT and ANGLESTEP
                             are specified then ANGLE will represent the inition rotation.
ANGLESTEP *                  If COUNT is more than one, Add this value to the current rotation angle.
SCALE *                      Scale the image by the specified amount.
SCALESTE *                   If COUNT is more than one, Add this value to the current scale value.
HFLIP *                      Horizontal flip. The origin will also be flipped.
VFLIP *                      Vertical flip. The origin will also be flipped.
PF or FORMAT                 Pixel format pf the output image. If not specified then the format of the source image will be used.
NAME                         Name of the image so that it can be found by a search
COUNT *                      Generate 'COUNT' output images. Each image may be rotated or scaled different if ANGLESTEP and/or SCALESTEP are specified.

* = Not currently implemented


IMAGEARRAY
----------

Create a series of images from a square 2 dimensional array within the source image. Each image will have the same 
dimensions and pixel format.


X                            X coordinate in pixels of the top left of the source region within the parent image
Y                            Y coordinate in pixels of the top left of the source region within the parent image
W or WIDTH                   Width of each image in pixels
H or HEIGHT                  Height of each image in pixels
XO or XORIGIN                X Origin of each image in pixels. The image will be rendered with the origin placed at the specified 
                             coordinate. Rotations will use this as the origin of rotation
YO or YORIGIN                Y Origin of each image in pixels. The image will be rendered with the origin placed at the specified 
                             coordinate. Rotations will use this as the origin of rotation
XC or XCOUNT                 The width of the image array measured in number of images. This value multiplied by YC will determine 
                             the total number of images.
YC or YCOUNT                 The height of the image array measured in number of images. This value multiplied by XC will determine 
                             the total number of images.
PF or FORMAT                 Pixel format pf the output image. If not specified then the format of the source image will be used.
HFLIP                        Horizontally flip each image. 0 = noflip, >0 = flip
VFLIP                        Vertically flip each image. 0 = noflip, >0 = flip

IMAGEGROUP
----------

Images are placed into groups. This command selects the group that following images will be inserted into.  The BASE parameter 
can be used to specify the index that the following images will start at in the group.

IMAGEGROUP [,GROUP=<group-number>] [,NAME=<group name>] [,BASE=<base>] 

GROUP	                       Group number. Defaults to 0
NAME                         Group name. Can be used to search for the group.
BASE                         Base index for images added to the group. Defaults to 0.


LOADIMAGE
---------

LOADIMAGE [,SRC=<filename>] [,FORMAT=<output pixel format>] [,COLOURMAP=<colour map name>]

SRC                          Filename of the image file
FORMAT                       Desired output pixel format
COLOURMAP                    Use this colour map instead of generating a new one or using the colour map from the source file.
                             Colours will be mapped in the best way possible to the selected colourmap.

NOTE: If the image format is palettized, a colourmap will be generated and made current.


TILE
----

Add a tile to the current tileset. Use the TILESET command to create or set the current tileset.

X                            X coordinate in pixels of the top left of the tiles source region within the parent image
Y                            Y coordinate in pixels of the top left of the tiles source region within the parent image
HFLIP                        Flip the tile image horizontally. This parameter does not require a value.
VFLIP                        Flip the tile image vertically. This parameter does not require a value.
ROTATE or ROTATION           Rotate the tile image. Valid values are 0, 90, 180 & 270 degrees.


TILEARRAY
---------

Add a series of tiles to the current tileset. The tiles are taken from a 2 dimensional array of sub-images
within the source image. 

X                            X coordinate in pixels of the top left of the tiles source region within the parent image
Y                            Y coordinate in pixels of the top left of the tiles source region within the parent image
TW or WIDTH or TILES-WIDE    The width of the 2 dimensional array measured in tiles.
TH or HEIGHT or TILES-HIGH   The height of the 2 dimensional array measured in tiles.
HFLIP                        Flip each tile image horizontally. This parameter does not require a value.
VFLIP                        Flip each tile image vertically. This parameter does not require a value.
ROTATE or ROTATION           Rotate each tile image. Valid values are 0, 90, 180 & 270 degrees.


TILESET
-------

Create an empty tileset or select an existing tileset.

ID                           Numerical identifier of the tileset.
NAME                         Name of the tileset that can be used for searching.
W or WIDTH                   Width of each tile in pixels.
H or HEIGHT                  Height of each tile in pixels.
PF or FORMAT                 Pixel format pf the timeset image data. If not specified then the format of the source image will be used.



SOUND
-----

Create a new sound.

NAME                         Name of the sound, maximum of 15 characters.

SOUND_MODULE
------------

Add a module to the current sound.

TYPE                         Module type
ID                           Used to identify the module in other sound commands. The ID will not be part of the output file.
<PARAM>                      Module specific parameters. Will be decoded based upon the module type.

SOUND_CONNECT
-------------

Connect a modules output to another modules input.

SRCMOD                       The index or ID of the module whose output will be used.
DESTMOD                      The index or ID of the module whose input will be used.
OUTPUT                       The index or name of the output pin.
INPUT                        The index of name of the input parameter.


SOUND_CONTROL
-------------

Assign a particular modules input parameter to a predefined control type.

CONTROL                      The control to bind a modules parameter to. Available control types are -
                             		CONTROL_GATE          Used mainly for controlling modules such as an envelope.
                             		CONTROL_PITCH         Used when a music player needs to set the pitch of the sound
                             		CONTROL_GAIN
                             		CONTROL_USER1         User controls are generic controls that can be used to expose
                             		CONTROL_USER2         module parameters.
                             		CONTROL_USER3
                             		CONTROL_USER4
MODULE                       The index or ID of the module whose parameter the control will bind to.
PARAM                        The parameter index or type that the control will bind to.


SOUND_OUTPUT
------------

Bind a module output to one of the sound outputs.

OUTPUT                       The sound output to bind to. Possible values are -
                                 MAIN         The main audio output
                                 FINISHED     Used to detect when the sound has finished playing. Not all sounds do
                                              finish. Some modules, such as an envelope generator may have a finished
                                              output to signal when the envelope has reached the end of it's cycle.
MODULE                       The index or ID of the module whose output will be used as the sounds output.
MODOUTPUT                    The index or name of the modules output that will be selected. Default Value is 0. The
                             names of the outputs are specific to the module type.


SOUND_DATA
----------

Load some data that can be used by the current sound module.  The type of data depends upon the module type. 
For A waveform module, the data could represent a sampled audio waveform.

SRC                          The source of the data. This is generally a file path. A waveform module, for example
                             could use a sampled audio file such as a .WAV or .OGG etc.
